<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gem 5 Acceleration &mdash; Architecture Reaserch Group 1.0.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Staff Members" href="staff.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Architecture Reaserch Group
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="staff.html">Staff Members</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Gem 5 Acceleration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configurations">Configurations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#atomicsimplecpu-atomic">AtomicSimpleCPU (Atomic)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#timingsimplecpu-timing">TimingSimpleCPU (Timing)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#in-order-cpu-minor">In-order CPU (Minor)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#out-of-order-cpu-o3">Out-of-order CPU (O3)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#base-hardware-configuration-on-firesim">Base Hardware Configuration on FireSim</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#we-set-out-to-find-the-answers-to-the-following-questions">We set out to find the answers to the following questions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#firesim-howto">FireSim HowTo</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Architecture Reaserch Group</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Gem 5 Acceleration</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Gem5Acceleration.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="gem-5-acceleration">
<h1>Gem 5 Acceleration<a class="headerlink" href="#gem-5-acceleration" title="Permalink to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>This is just a simple copy-paste from the paper. We need to trim it…</p>
<p>Software-based simulation is the backbone of computer architecture research and development. Since the inception of computer architecture as a field, many software-based
architectural simulators1 have emerged. Currently, various architectural simulators are in-use by academia and industry for modeling different aspects of future computing platforms.
gem5, Sniper, MARSSx86, and ZSim are just a few examples of architectural simulators with currently active communities. gem5 is one of the most popular hardware simulator in the community. Howerver,
software-based architectural simulation is slow. We observed that gem5 runs up to 1.7x~3.7x faster on a MacBook Pro w/ M1 vs. Dell server w/ Intel Xeon Gold.
So, we extensively profiled gem5 using hardware performance counters on both Intel and Apple’s CPUs. We found that gem5 is fronend-bounded and it is very sensetive to L1 cache size.</p>
<p>..warning:: That’s how we should include warnings
.. this is how you can make a note
..note:: That’s how we should include notes
.. this is how you can make tips
..tip:: That’s how you should include tips
.. this is how you insert an image, make sure it is alse in the img folder
..image:: img/KU_campus_V2.png</p>
</section>
<section id="configurations">
<h2>Configurations<a class="headerlink" href="#configurations" title="Permalink to this heading"></a></h2>
<p>Add some text ….
We change the CPU type, number of CPUs, and memory size. We use the following CPU types:</p>
<section id="atomicsimplecpu-atomic">
<h3>AtomicSimpleCPU (Atomic)<a class="headerlink" href="#atomicsimplecpu-atomic" title="Permalink to this heading"></a></h3>
<p>CPU type with CPI = 1 where memory accesses are atomic and completed without modeling any contention or queuing delays.</p>
<section id="timingsimplecpu-timing">
<h4>TimingSimpleCPU (Timing)<a class="headerlink" href="#timingsimplecpu-timing" title="Permalink to this heading"></a></h4>
<p>CPU type with CPI = 1 where memory accesses are modeled in detail considering the queuing delays and resource contentions in the memory and interconnect.</p>
</section>
<section id="in-order-cpu-minor">
<h4>In-order CPU (Minor)<a class="headerlink" href="#in-order-cpu-minor" title="Permalink to this heading"></a></h4>
<p>In-order or Minor CPU models a fixed pipeline with strict in-order instruction execution. Minor CPU uses the detailed timing memory mode  for accessing memory.</p>
</section>
<section id="out-of-order-cpu-o3">
<h4>Out-of-order CPU (O3)<a class="headerlink" href="#out-of-order-cpu-o3" title="Permalink to this heading"></a></h4>
<p>O3 CPU models an out-of-order superscalar loosely based on the Alpha 2126 core. O3 CPU uses the detailed timing memory model for accessing memory.</p>
<p>Some text refering to the table below ….</p>
</section>
</section>
<section id="base-hardware-configuration-on-firesim">
<h3>Base Hardware Configuration on FireSim<a class="headerlink" href="#base-hardware-configuration-on-firesim" title="Permalink to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Parameters</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Core Frequency</p></td>
<td><p>4GHz</p></td>
</tr>
<tr class="row-odd"><td><p>Number of Cores</p></td>
<td><p>4 Cores</p></td>
</tr>
<tr class="row-even"><td><p>Superscalar</p></td>
<td><p>8-width wide</p></td>
</tr>
<tr class="row-odd"><td><p>ROB/IQ/LQ/SQ Entries</p></td>
<td><p>192/64/32/32</p></td>
</tr>
<tr class="row-even"><td><p>Int &amp; FP Registers</p></td>
<td><p>128 &amp; 192</p></td>
</tr>
<tr class="row-odd"><td><p>Branch Predictor/BTB Entries</p></td>
<td><p>TournamentBP/4096</p></td>
</tr>
<tr class="row-even"><td><p>Cache: L1I/L1D</p></td>
<td><p>48KB(I), 32KB(D)</p></td>
</tr>
<tr class="row-odd"><td><p>DRAM</p></td>
<td><p>2GB, DDR3-1600-8x8</p></td>
</tr>
<tr class="row-even"><td><p>Operating System</p></td>
<td><p>Linux Linaro (kernel 5.4.0)</p></td>
</tr>
</tbody>
</table>
<section id="we-set-out-to-find-the-answers-to-the-following-questions">
<h4>We set out to find the answers to the following questions<a class="headerlink" href="#we-set-out-to-find-the-answers-to-the-following-questions" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>Where are the bottlenecks in a state-of-theart architectural simulator?</p></li>
<li><p>How much faster can architectural simulations run by tuning system configurations?</p></li>
<li><p>What are the opportunities in accelerating software simulation using hardware accelerators?</p></li>
</ul>
</section>
</section>
</section>
<section id="firesim-howto">
<h2>FireSim HowTo<a class="headerlink" href="#firesim-howto" title="Permalink to this heading"></a></h2>
<p>some text talking about the firesim and refering to the steps below.
also refer to the firesim website for more information - <a class="reference external" href="https://fires.im/">https://fires.im/</a></p>
<ol class="arabic simple">
<li><p>Set up the AWS FireSim environment</p></li>
<li><p>Build the gem5 binary for RISCV ISA</p></li>
<li><p>Prepare gem5 workload and transfer it to the instance</p></li>
<li><p>Create FireSim workload using FireMarshal</p></li>
<li><p>Build our target design</p></li>
<li><p>PModify parameters, tests, and results</p></li>
</ol>
<p>We specify a quad-core rocket chip with a 64KB L1 icache and dcache in the TargetConfigs.scala file. Parameter at the top of arrow overrides others below.</p>
<p>We specify a quad-core rocket chip with a 64KB L1 icache and dcache in the TargetConfigs.scala file. Parameter at the top of arrow overrides others below.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mosh<span class="w"> </span>--ssh<span class="s2">&quot;=ssh -i firesim.pem&quot;</span><span class="w"> </span>username@ip_addr
</pre></div>
</div>
<p>FireSim .json file is modified to run gem5</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>,json<span class="w"> </span>file<span class="w"> </span>should<span class="w"> </span>be<span class="w"> </span>added!
</pre></div>
</div>
<p>We use a quad-core Rocket Chip with an 8KB 2-way set associative icache &amp; dcache, and a 512KB l2 cache base config.</p>
<p>We modify config_build.yaml, config_hwdb.yaml, config_runtime.yaml, &amp; config_build_receipes.yaml files</p>
<p>To change the base system configuration, we had to specify new design parameters in TargetConfigs.scala or RocketConfigs.scala</p>
<p>Next, we use golden gate compiler to generate the verilog code from the Chisel-generated RTL code for the AWS AGFI build process.</p>
<p>FireSim requires a .json input file format to define workloads (e.g. gem5) that will run on the target design. FireMarshal is used to manage this process. Check out the FireMarshal documentation for more details.</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://firemarshal.readthedocs.io/en/latest/index.html">https://firemarshal.readthedocs.io/en/latest/index.html</a></p></li>
</ul>
</div></blockquote>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;benchmark_name&quot;</span>:<span class="w"> </span><span class="s2">&quot;gem5-workload&quot;</span>,
<span class="s2">&quot;common_simulation_outputs&quot;</span>:<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;uartlog&quot;</span>,<span class="s2">&quot;memory_stats*.csv&quot;</span>,<span class="w"> </span><span class="s2">&quot;TRACEFILE*&quot;</span><span class="o">]</span>,
<span class="s2">&quot;common_simulation_inputs&quot;</span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;gem5-workload-gem5-bin-dwarf&quot;</span><span class="o">]</span>,
<span class="s2">&quot;post_run_hook&quot;</span>:<span class="w"> </span><span class="s2">&quot;gen-all-flamegraphs-fireperf.sh&quot;</span>,
<span class="s2">&quot;workloads&quot;</span>:<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="o">{</span>
<span class="s2">&quot;name&quot;</span>:<span class="w"> </span><span class="s2">&quot;gem5-workload-gem5&quot;</span>,
<span class="s2">&quot;bootbinary&quot;</span>:<span class="w"> </span><span class="s2">&quot;../../../target-design/chipyard/software/firemarshal/images/gem5-workload-gem5-bin&quot;</span>,
<span class="s2">&quot;rootfs&quot;</span>:<span class="w"> </span><span class="s2">&quot;../../../target-design/chipyard/software/firemarshal/images/gem5-workload-gem5.img&quot;</span>,
<span class="s2">&quot;outputs&quot;</span>:<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;/root/sim-environment/m5out&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="o">]</span>
</pre></div>
</div>
<p>Modifying config_build.yaml</p>
<p>We used a Z1d.2xlarge FireSim manager instance</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>//add<span class="w"> </span>the<span class="w"> </span>commandline<span class="w"> </span>code<span class="w"> </span>here,<span class="w"> </span><span class="k">for</span><span class="w"> </span>example<span class="w"> </span>how<span class="w"> </span>to<span class="w"> </span>ssh<span class="w"> </span>into<span class="w"> </span>the<span class="w"> </span>f1<span class="w"> </span>instance
firesim_rocket_quadcore_gem5_config4
agfi:<span class="w"> </span>agfi-0ae1574040e7ff0fc
deploy_triplet_override:<span class="w"> </span>null
custom_runtime_config:<span class="w"> </span>null
firesim_rocket_quadcore_gem5_config5:<span class="w"> </span><span class="c1"># Add your AGFI info to config_hwdb.yaml, so they can be deployed during simulation​</span>
agfi:<span class="w"> </span>agfi-06e876ba9378cc9ff
deploy_triplet_override:<span class="w"> </span>null
custom_runtime_config:<span class="w"> </span>null
firesim_rocket_quadcore_gem5_config6:
agfi:<span class="w"> </span>agfi-00a966236eb672af3
deploy_triplet_override:<span class="w"> </span>null
custom_runtime_config:<span class="w"> </span>null
firesim_rocket_quadcore_gem5_config7:
agfi:<span class="w"> </span>agfi-0bc64b009db5f849a
deploy_triplet_override:<span class="w"> </span>null
custom_runtime_config:<span class="w"> </span>null
</pre></div>
</div>
<p>}</p>
<p>if you need hyperlink, you can use this template:</p>
<p>firesim website is <a class="reference external" href="https://fires.im/">this</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="staff.html" class="btn btn-neutral float-left" title="Staff Members" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, University of Knasas I2S|Institute for Information Sciences.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>